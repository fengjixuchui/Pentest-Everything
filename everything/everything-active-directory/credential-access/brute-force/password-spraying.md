---
description: https://attack.mitre.org/techniques/T1110/003/
---

# Password Spraying

**ATT\&CK ID:** [T1110.003](https://attack.mitre.org/techniques/T1110/003/)

**Permissions Required:** <mark style="color:green;">**User**</mark>

**Description**

Adversaries may use a single or small list of commonly used passwords against many different accounts, in order to attempt acquisition of valid account credentials.

Password spraying uses one password (e.g. 'Password01'), or a small list of commonly used passwords, that may match the complexity policy of the domain. Logins are attempted with that password against many different accounts on a network to avoid account lockouts that would normally occur when brute forcing a single account with many passwords.

\[[source](https://attack.mitre.org/techniques/T1110/003/)]

## Techniques (Linux)

### Crackmapexec

```bash
crackmapexec <Service> <IP> -u <UserList> -p <PasswordList>
```

### Hydra

```bash
hydra -L <userList> -P <PasswordList> <Service>://<IP> -v -I 
```

## Techniques (Windows)

### Invoke-DomainPasswordSpray

**Link:** [https://github.com/dafthack/DomainPasswordSpray](https://github.com/dafthack/DomainPasswordSpray)

```bash
Invoke-DomainPasswordSpray -PasswordList .\Passwords.txt -Domain <Domain> -ErrorAction SilentlyContinue
```

![](<../../../../.gitbook/assets/image (2011).png>)

## Scenario

In the scenario below we have a Windows Server 2022 Domain Controller containing the following domain user accounts:

![](../../../../.gitbook/assets/ADusers.PNG)

In an enterprise environment we might imagine Active Directory would contain hundreds even thousands of domain user accounts. Below we can see the Default Domain Policy for the 'Account Policies/Account Lockout Policy' setting.

![](../../../../.gitbook/assets/GPO.PNG)

The settings show above are the generally the default lockout settings you will find in domain environments. With the default settings, a Bruce Force attack is possible however, severely hindered by the 30 minute lockout timer.

We also have the issue where locking out accounts is 'noisy' and may trigger alerts against the enterprise's blue team.

The advantage here of password spraying is we can attempt to Brute Force a large amount of accounts against a very small common password lists and hope for a hit. As long the attackers stay below the lockout thresh hold this attack can be quite stealthy.

Below a single user account has been Brute Forced with a large password list locking the account out.

![](<../../../../.gitbook/assets/image (1737) (1).png>)

Over on the Domain Controller we can see under the event logs for event **ID 4740** where the account was locked out.

![](../../../../.gitbook/assets/event.PNG)

Attempting to spray passwords against a list of known users we see some nice results using a small password list which is short enough to not trigger the account lockout for each account.

![](<../../../../.gitbook/assets/image (1738).png>)

## Mitigations

* Set account lockout policies after a certain number of failed login attempts to prevent passwords from being guessed. Too strict a policy may create a denial of service condition and render environments un-usable, with all accounts used in the brute force being locked-out.
* Use multi-factor authentication. Where possible, also enable multi-factor authentication on externally facing services.
* Ensure passwords exceed 14 characters.
* Follow the principal of least privilege. Only allow users to authenticate to applications if it is an absolute requirement for their role.

### &#x20;<a href="#detection" id="detection"></a>
